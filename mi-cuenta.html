<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Cuenta - Ecosistema Informacional</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@700;900&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://unpkg.com/heroicons@2.0.18/24/outline/index.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="style-mobile.css">
    <style>
/* === Estilos del modal de autenticaci√≥n === */
.login-modal {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}

.login-overlay {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0, 0, 0, 0.6);
  backdrop-filter: blur(4px);
}

.login-box {
  position: relative;
  background: #fff;
  padding: 30px 40px;
  border-radius: 10px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.25);
  z-index: 10000;
  width: 90%;
  max-width: 380px;
  text-align: center;
}

.login-box h3 {
  margin-bottom: 10px;
  color: #004b8d;
  font-size: 1.5em;
}

.login-box p {
  color: #666;
  font-size: 14px;
  margin-bottom: 15px;
  line-height: 1.5;
}

.login-box .session-message {
  background: #fff3cd;
  border: 1px solid #ffc107;
  border-radius: 6px;
  padding: 12px;
  margin-bottom: 15px;
  color: #856404;
  font-size: 13px;
  display: none;
}

.login-box .session-message.show {
  display: block;
}

.login-box label {
  display: block;
  text-align: left;
  font-weight: 600;
  margin-top: 12px;
  color: #333;
  font-size: 14px;
}

.login-box input {
  width: 100%;
  padding: 12px;
  margin-top: 5px;
  border: 1px solid #ccc;
  border-radius: 6px;
  box-sizing: border-box;
  font-size: 14px;
}

.login-box input:focus {
  outline: none;
  border-color: #004b8d;
  box-shadow: 0 0 0 3px rgba(0, 75, 141, 0.1);
}

.login-box .forgot-password {
  display: block;
  text-align: right;
  margin-top: 8px;
  color: #004b8d;
  font-size: 13px;
  text-decoration: none;
  font-weight: 500;
}

.login-box .forgot-password:hover {
  text-decoration: underline;
}

.login-box button {
  margin-top: 18px;
  width: 100%;
  padding: 12px;
  background-color: #004b8d;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
  font-size: 15px;
  transition: background-color 0.3s;
}

.login-box button:hover {
  background-color: #003a6d;
}

.login-box .btn-cancel {
  display: block;
  margin-top: 10px;
  padding: 10px;
  background-color: transparent;
  color: #666;
  border: 1px solid #ddd;
  border-radius: 6px;
  text-decoration: none;
  text-align: center;
  font-weight: 500;
  font-size: 14px;
  transition: all 0.3s;
}

.login-box .btn-cancel:hover {
  background-color: #f8f9fa;
  border-color: #adb5bd;
  color: #495057;
}

.login-box .modal-view {
  animation: fadeIn 0.3s ease-in-out;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.login-box .success-icon {
  font-size: 48px;
  margin-bottom: 15px;
  animation: scaleIn 0.5s ease-in-out;
}

@keyframes scaleIn {
  0% {
    transform: scale(0);
  }
  50% {
    transform: scale(1.1);
  }
  100% {
    transform: scale(1);
  }
}

.login-box .btn-primary-full {
  margin-top: 20px;
  width: 100%;
  padding: 12px;
  background-color: #004b8d;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
  font-size: 15px;
  transition: background-color 0.3s;
}

.login-box .btn-primary-full:hover {
  background-color: #003a6d;
}

.logout-link {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  color: #004b8d;
  font-weight: 600;
  text-decoration: none;
  padding: 8px 16px;
  border-radius: 6px;
  transition: all 0.3s;
  font-size: 14px;
}

.logout-link:hover {
  background-color: rgba(0, 75, 141, 0.1);
  text-decoration: none;
}

.logout-link i {
  font-size: 16px;
}
</style>
</head>
<body>
<!-- === Modal de autenticaci√≥n === -->
<div id="login-modal" class="login-modal">
  <div class="login-overlay"></div>
  <div class="login-box">
    <!-- Vista 1: Login -->
    <div id="login-view" class="modal-view">
      <h3>üîí Inicia sesi√≥n</h3>
      <p id="login-message">Por seguridad, ingresa tus credenciales institucionales.</p>
      <div id="session-alert" class="session-message"></div>
      <form id="login-form">
        <label for="username">Usuario</label>
        <input type="text" id="username" placeholder="Correo institucional" required autocomplete="username">
        <label for="password">Contrase√±a</label>
        <input type="password" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required autocomplete="current-password">
        <a href="#" id="forgot-password-link" class="forgot-password">¬øOlvidaste la contrase√±a?</a>
        <button type="submit">Iniciar sesi√≥n</button>
        <a href="index.html" class="btn-cancel">Ir a Inicio</a>
      </form>
    </div>

    <!-- Vista 2: Recuperaci√≥n de contrase√±a -->
    <div id="recovery-view" class="modal-view" style="display: none;">
      <h3>üîë Recuperar contrase√±a</h3>
      <p>Ingresa tu correo institucional y te enviaremos las instrucciones para restablecer tu contrase√±a.</p>
      <form id="recovery-form">
        <label for="recovery-email">Correo electr√≥nico institucional</label>
        <input type="email" id="recovery-email" placeholder="ejemplo@uacj.mx" required autocomplete="email">
        <button type="submit">Enviar solicitud</button>
        <a href="#" id="back-to-login" class="btn-cancel">Volver al inicio de sesi√≥n</a>
      </form>
    </div>

    <!-- Vista 3: Confirmaci√≥n -->
    <div id="confirmation-view" class="modal-view" style="display: none;">
      <div class="success-icon">‚úÖ</div>
      <h3>Solicitud enviada</h3>
      <p>Hemos enviado las instrucciones para recuperar tu contrase√±a a tu correo electr√≥nico.</p>
      <p style="font-size: 14px; color: #666; margin-top: 15px;">
        Por favor, revisa tu bandeja de entrada y sigue los pasos indicados. Si no recibes el correo en unos minutos, verifica tu carpeta de spam.
      </p>
      <button id="back-to-login-confirmed" class="btn-primary-full">Volver al inicio de sesi√≥n</button>
      <a href="index.html" class="btn-cancel">Ir a Inicio</a>
    </div>
  </div>
</div>
    <div class="header-wrapper">
        <header class="header container">
            <a href="index.html" class="logo">Ecosistema Informacional</a>
            <nav class="main-nav">
                <ul>
                    <li><a href="index.html">Inicio</a></li> 
                    <li><a href="buscar.html">Buscar y Descubrir</a></li> 
                    <li><a href="servicios.html">Servicios</a></li> 
                    <li><a href="apoyo-ayuda.html">Apoyo y Ayuda</a></li>
                    <li><a href="sobre-nosotros.html">Sobre Nosotros</a></li>
                    <li><a href="normas-politicas.html">Normas y Pol√≠ticas</a></li>
                </ul>
            </nav>
            <button class="mobile-menu-toggle" id="mobile-menu-btn" aria-label="Abrir men√∫">
                <span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
            </button>
            <a href="#" id="logout-btn" class="btn-cta logout-link">
                <i class="fas fa-sign-out-alt"></i> Cerrar Sesi√≥n
            </a>
        </header>
    </div>
    <nav class="mobile-nav" id="mobile-nav">
        <ul>
            <li><a href="index.html">Inicio</a></li>
            <li><a href="buscar.html">Buscar y Descubrir</a></li>
            <li><a href="servicios.html">Servicios</a></li>
            <li><a href="apoyo-ayuda.html">Apoyo y Ayuda</a></li>
            <li><a href="sobre-nosotros.html">Sobre Nosotros</a></li>
            <li><a href="normas-politicas.html">Normas y Pol√≠ticas</a></li>
        </ul>
    </nav>
    <main>
        <section class="page-header">
            <div class="container" style="text-align: left;">
                <h1>Mi Cuenta</h1>
            </div>
        </section>
        <div class="dashboard-layout container">
            <aside class="dashboard-nav">
                <div class="user-info">
                    <img src="dcruz-foto.png" alt="Foto de perfil de Daniel Cruz" class="avatar">
                    <h3>Daniel Cruz Bautista</h3>
                    <p>dcruz@uacj.mx</p>
                </div>
                <ul id="dashboard-menu">
                    <li><a class="dashboard-nav-link active" data-target="panel-prestamos">Pr√©stamos Vigentes</a></li>
                    <li><a class="dashboard-nav-link" data-target="panel-favoritos">Favoritos y Listas</a></li>
                    <li><a class="dashboard-nav-link" data-target="panel-historial">Historial (B√∫squeda y Pr√©stamo)</a></li>
                    <li><a class="dashboard-nav-link" data-target="panel-solicitudes">Solicitudes Realizadas</a></li>
                    <li><a class="dashboard-nav-link" data-target="panel-constancias">Constancias y Tr√°mites</a></li>
                    <li><a class="dashboard-nav-link" data-target="panel-certificados">Certificados de Cursos</a></li>
                    <li><a class="dashboard-nav-link" data-target="panel-perfil">Perfil y Notificaciones</a></li>
                </ul>
            </aside>
            <section class="dashboard-content">
                <div id="panel-prestamos" class="dashboard-panel active">
                    <h2>Pr√©stamos Vigentes</h2>
                    <p>Aqu√≠ puedes ver el estado de tus pr√©stamos actuales y renovarlos.</p>
                    <div class="loan-list">
                        <div class="loan-card">
                            <div class="loan-cover-placeholder">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 40px; height: 40px;"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" /></svg>
                            </div>
                            <div class="loan-info">
                                <h3>Introducci√≥n al Marketing Digital</h3>
                                <p><strong>Autor:</strong> Philip Kotler</p>
                                <p><strong>Fecha de Pr√©stamo:</strong> 15 de Octubre, 2025</p>
                                <p><strong>Fecha de Devoluci√≥n:</strong> 31 de Octubre, 2025</p>
                                <div class="loan-actions">
                                    <a href="#" class="btn-small">Renovar</a>
                                </div>
                            </div>
                        </div>
                        <div class="loan-card">
                            <div class="loan-cover-placeholder">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 40px; height: 40px;"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" /></svg>
                            </div>
                            <div class="loan-info">
                                <h3>Inteligencia Artificial: Un Enfoque Moderno</h3>
                                <p><strong>Autor:</strong> Stuart Russell</p>
                                <p><strong>Fecha de Pr√©stamo:</strong> 18 de Octubre, 2025</p>
                                <p class="due-soon"><strong>Fecha de Devoluci√≥n:</strong> 3 de Noviembre, 2025 (¬°Vence pronto!)</p>
                                <div class="loan-actions">
                                    <a href="#" class="btn-small">Renovar</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="panel-favoritos" class="dashboard-panel">
                    <h2>Favoritos y Listas</h2>
                    <p>Art√≠culos, libros y b√∫squedas que has guardado.</p>
                </div>
                <div id="panel-historial" class="dashboard-panel">
                    <h2>Historial</h2>
                    <p>Tu historial de pr√©stamos y b√∫squedas anteriores.</p>
                </div>
                <div id="panel-solicitudes" class="dashboard-panel">
                    <h2>Solicitudes Realizadas</h2>
                    <p>Estado de tus pr√©stamos interbibliotecarios o solicitudes de digitalizaci√≥n.</p>
                </div>
                <div id="panel-constancias" class="dashboard-panel">
                    <h2>Constancias y Tr√°mites</h2>
                    <p>Genera tus documentos oficiales de biblioteca aqu√≠.</p>

                    <!-- Alerta importante -->
                    <div style="background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px; padding: 20px; margin-bottom: 25px;">
                        <h4 style="color: #856404; margin: 0 0 10px 0; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-exclamation-triangle"></i>
                            Importante: Requisitos para Constancia de No Adeudo
                        </h4>
                        <ul style="color: #856404; margin: 0; padding-left: 20px; line-height: 1.8;">
                            <li><strong>Disponibilidad:</strong> Esta constancia solo estar√° disponible si est√°s libre de adeudos de material y multas.</li>
                            <li><strong>Suspensi√≥n de servicios:</strong> Al momento de solicitar la constancia, tu servicio de pr√©stamo ser√° suspendido autom√°ticamente.</li>
                        </ul>
                    </div>

                    <div class="constancia-box">
                        <h3>Constancia de No Adeudo</h3>
                        <p>Genera un documento PDF oficial que certifica que no tienes adeudos de material o multas pendientes.</p>

                        <!-- Estado del usuario -->
                        <div id="user-status" style="background: #d4edda; border: 1px solid #c3e6cb; border-radius: 6px; padding: 15px; margin: 15px 0;">
                            <p style="margin: 0; color: #155724;">
                                <i class="fas fa-check-circle"></i>
                                <strong>Estado actual:</strong> Sin adeudos pendientes. Puedes solicitar tu constancia.
                            </p>
                        </div>

                        <button class="btn-generate" id="generate-constancia">
                            Generar Constancia (Suspender√° pr√©stamos)
                        </button>
                    </div>
                    <h3 style="margin-top: 40px; color: var(--color-texto);">Historial de Solicitudes</h3>
                    <table class="history-table">
                        <thead>
                            <tr>
                                <th>Documento</th>
                                <th>Fecha de Solicitud</th>
                                <th>Estado</th>
                                <th>Descarga</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Constancia de No Adeudo</td>
                                <td>15 de Mayo, 2025</td>
                                <td>Expirado</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>Constancia de No Adeudo</td>
                                <td>28 de Octubre, 2025</td>
                                <td>Vigente</td>
                                <td><a href="#" class="btn-small">Descargar PDF</a></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                </div>
                <div id="panel-certificados" class="dashboard-panel">
                    <h2>Certificados de Cursos</h2>
                    <p>Descarga los certificados de los talleres de ALFIN que has completado.</p>
                </div>
                <div id="panel-perfil" class="dashboard-panel">
                    <h2>Perfil y Notificaciones</h2>
                    <p>Configura tu correo electr√≥nico y tus preferencias de notificaci√≥n.</p>
                </div>
            </section>
<section class="suggestions-ia container" style="margin-top: 40px;">
      <h2 style="text-align:left;">Sugerencias para ti por IA</h2>
      <div class="swiper suggestions-carousel">
        <div class="swiper-wrapper">
          <!-- Sugerencia 1 -->
          <div class="swiper-slide">
            <div class="book-card">
              <img src="https://upload.wikimedia.org/wikipedia/commons/6/65/No-Image-Placeholder.svg" alt="Portada gen√©rica" style="width:100%;max-width:110px;display:block;margin:0 auto 10px;">
              <h4>Deep Learning</h4>
              <p>Ian Goodfellow, Yoshua Bengio | MIT Press</p>
              <a href="#" class="btn-solicitar">Solicitar</a>
            </div>
          </div>
          <!-- Sugerencia 2 -->
          <div class="swiper-slide">
            <div class="book-card">
              <img src="https://upload.wikimedia.org/wikipedia/commons/6/65/No-Image-Placeholder.svg" alt="Portada gen√©rica" style="width:100%;max-width:110px;display:block;margin:0 auto 10px;">
              <h4>Nature</h4>
              <p>Revista l√≠der en ciencia y tecnolog√≠a.</p>
              <a href="https://www.nature.com/" class="btn-solicitar" target="_blank">Ir a Revista</a>
            </div>
          </div>
          <!-- Sugerencia 3 -->
          <div class="swiper-slide">
            <div class="book-card">
              <img src="https://upload.wikimedia.org/wikipedia/commons/6/65/No-Image-Placeholder.svg" alt="Portada gen√©rica" style="width:100%;max-width:110px;display:block;margin:0 auto 10px;">
              <h4>Artificial Intelligence: A Modern Approach</h4>
              <p>Russell & Norvig | Pearson</p>
              <a href="#" class="btn-solicitar">Solicitar</a>
            </div>
          </div>
          <!-- Sugerencia 4 -->
          <div class="swiper-slide">
            <div class="book-card">
              <img src="https://upload.wikimedia.org/wikipedia/commons/6/65/No-Image-Placeholder.svg" alt="Portada gen√©rica" style="width:100%;max-width:110px;display:block;margin:0 auto 10px;">
              <h4>Science</h4>
              <p>Revista internacional de investigaci√≥n cient√≠fica.</p>
              <a href="https://www.science.org/journal/science" class="btn-solicitar" target="_blank">Ir a Revista</a>
            </div>
          </div>
          <!-- Sugerencia 5 -->
          <div class="swiper-slide">
            <div class="book-card">
              <img src="https://upload.wikimedia.org/wikipedia/commons/6/65/No-Image-Placeholder.svg" alt="Portada gen√©rica" style="width:100%;max-width:110px;display:block;margin:0 auto 10px;">
              <h4>Machine Learning: A Probabilistic Perspective</h4>
              <p>Kevin P. Murphy | MIT Press</p>
              <a href="#" class="btn-solicitar">Solicitar</a>
            </div>
          </div>
        </div>
        <div class="swiper-pagination"></div>
        <div class="swiper-button-prev"></div>
        <div class="swiper-button-next"></div>
      </div>
    </section>
        </div>
    </main>
    <footer class="footer">
        <div class="container">
            <div class="footer-col"><h4 class="logo" style="color: var(--color-blanco);">Ecosistema Informacional</h4><p>Av. Plutarco El√≠as Calles #1210<br>Fovissste Chamizal, C.P. 32310</p></div>
            <div class="footer-col"><h4>Enlaces R√°pidos</h4><ul><li><a href="sobre-nosotros.html">Sobre Nosotros</a></li><li><a href="https://catalogo.uacj.mx/">Cat√°logo</a></li><li><a href="servicios.html">Servicios</a></li><li><a href="apoyo-ayuda.html">Contacto</a></li></ul></div>
            <div class="footer-col"><h4>Recursos</h4><ul><li><a href="bases-de-datos.html">Bases de Datos</a></li><li><a href="#">Repositorio</a></li><li><a href="guias-tematicas.html">Gu√≠as Tem√°ticas</a></li><li><a href="#">Preguntas Frecuentes</a></li></ul></div>
            <div class="footer-col">
                <h4>Redes Sociales</h4>
                <ul class="footer-social-icons">
                    <li><a href="#" aria-label="Facebook" title="Facebook"><i class="fa-brands fa-facebook"></i></a></li>
                    <li><a href="#" aria-label="Twitter" title="Twitter"><i class="fa-brands fa-x-twitter"></i></a></li>
                    <li><a href="#" aria-label="Instagram" title="Instagram"><i class="fa-brands fa-instagram"></i></a></li>
                </ul>
            </div>
        </div>
    </footer>
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script>
      if (document.querySelector('.suggestions-carousel')) {
        new Swiper('.suggestions-carousel', {
          slidesPerView: 1,
          spaceBetween: 20,
          loop: true,
          autoplay: {
            delay: 3000,
            disableOnInteraction: false,
          },
          pagination: {
            el: '.swiper-pagination',
            clickable: true
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev'
          },
          breakpoints: {
            640: { slidesPerView: 2, spaceBetween: 15 },
            1024: { slidesPerView: 3, spaceBetween: 20 }
          }
        });
      }
    </script>

    <script>
    // JavaScript para navegaci√≥n del dashboard
    document.addEventListener('DOMContentLoaded', function() {
        const navLinks = document.querySelectorAll('.dashboard-nav-link');
        const panels = document.querySelectorAll('.dashboard-panel');

        navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Remover clase active de todos los enlaces
                navLinks.forEach(l => l.classList.remove('active'));
                
                // Agregar clase active al enlace clickeado
                this.classList.add('active');
                
                // Ocultar todos los paneles
                panels.forEach(panel => panel.classList.remove('active'));
                
                // Mostrar el panel correspondiente
                const targetId = this.getAttribute('data-target');
                const targetPanel = document.getElementById(targetId);
                if (targetPanel) {
                    targetPanel.classList.add('active');
                }
            });
        });

        // JavaScript para generar constancia
        const btnGenerate = document.getElementById('generate-constancia');
        if (btnGenerate) {
            btnGenerate.addEventListener('click', function() {
                // Validar si el usuario tiene adeudos (esto se har√≠a con tu backend)
                const tieneAdeudos = false; // Cambiar seg√∫n consulta real

                if (tieneAdeudos) {
                    alert('No puedes generar la constancia porque tienes adeudos pendientes. Por favor, regulariza tu situaci√≥n primero.');
                    return;
                }

                const confirmar = confirm(
                    '‚ö†Ô∏è IMPORTANTE:\n\n' +
                    '‚Ä¢ Al generar esta constancia, tu servicio de pr√©stamo ser√° SUSPENDIDO temporalmente.\n' +
                    '‚Ä¢ No podr√°s solicitar nuevos pr√©stamos hasta que la constancia expire (30 d√≠as) o sea utilizada.\n' +
                    '‚Ä¢ La constancia certifica que actualmente no tienes adeudos.\n\n' +
                    '¬øDeseas continuar?'
                );

                if (confirmar) {
                    alert('Constancia generada exitosamente.\n\nTu servicio de pr√©stamo ha sido suspendido temporalmente.\nRecibir√°s el PDF por correo electr√≥nico.');

                    // Actualizar el estado visualmente
                    const statusDiv = document.getElementById('user-status');
                    if (statusDiv) {
                        statusDiv.innerHTML = `
                            <p style="margin: 0; color: #856404;">
                                <i class="fas fa-pause-circle"></i>
                                <strong>Estado actual:</strong> Servicio de pr√©stamo suspendido por constancia vigente.
                            </p>
                        `;
                    }
                }
            });
        }
    });
    </script>

    <!-- === Script de Autenticaci√≥n y Control de Sesi√≥n === -->
    <script>
    document.addEventListener('DOMContentLoaded', () => {
      const modal = document.getElementById('login-modal');
      const loginView = document.getElementById('login-view');
      const recoveryView = document.getElementById('recovery-view');
      const confirmationView = document.getElementById('confirmation-view');
      
      const form = document.getElementById('login-form');
      const recoveryForm = document.getElementById('recovery-form');
      const logoutBtn = document.getElementById('logout-btn');
      const loginMessage = document.getElementById('login-message');
      const sessionAlert = document.getElementById('session-alert');
      const usernameInput = document.getElementById('username');
      const passwordInput = document.getElementById('password');
      const recoveryEmailInput = document.getElementById('recovery-email');
      
      const forgotPasswordLink = document.getElementById('forgot-password-link');
      const backToLoginLink = document.getElementById('back-to-login');
      const backToLoginConfirmed = document.getElementById('back-to-login-confirmed');
      
      let inactivityTimer;

      // === Funciones para cambiar entre vistas ===
      const showView = (viewToShow) => {
        [loginView, recoveryView, confirmationView].forEach(view => {
          view.style.display = 'none';
        });
        viewToShow.style.display = 'block';
      };

      // === Mostrar / Ocultar modal ===
      const showLogin = (reason = '') => {
        modal.style.display = 'flex';
        showView(loginView);
        
        // Limpiar los campos del formulario
        usernameInput.value = '';
        passwordInput.value = '';
        
        // Mostrar mensaje seg√∫n la raz√≥n
        if (reason === 'logout') {
          sessionAlert.textContent = '‚ö†Ô∏è Has cerrado sesi√≥n exitosamente.';
          sessionAlert.classList.add('show');
          loginMessage.textContent = 'Ingresa nuevamente tus credenciales para acceder.';
        } else if (reason === 'inactivity') {
          sessionAlert.textContent = '‚è±Ô∏è Tu sesi√≥n expir√≥ por inactividad (2 minutos).';
          sessionAlert.classList.add('show');
          loginMessage.textContent = 'Por seguridad, ingresa nuevamente tus credenciales.';
        } else if (reason === 'expired') {
          sessionAlert.textContent = '‚è±Ô∏è Tu sesi√≥n ha expirado.';
          sessionAlert.classList.add('show');
          loginMessage.textContent = 'Por seguridad, ingresa nuevamente tus credenciales.';
        } else {
          sessionAlert.classList.remove('show');
          loginMessage.textContent = 'Por seguridad, ingresa tus credenciales institucionales.';
        }
        
        // Enfocar el campo de usuario
        setTimeout(() => usernameInput.focus(), 100);
      };

      const hideLogin = () => {
        modal.style.display = 'none';
        sessionAlert.classList.remove('show');
      };

      // === Gesti√≥n de sesi√≥n ===
      const startSession = () => {
        localStorage.setItem('sessionActive', 'true');
        localStorage.setItem('lastActivity', Date.now());
        console.log('‚úÖ Sesi√≥n iniciada');
      };

      const clearSession = () => {
        localStorage.removeItem('sessionActive');
        localStorage.removeItem('lastActivity');
        console.log('üö™ Sesi√≥n cerrada');
      };

      const isSessionActive = () => localStorage.getItem('sessionActive') === 'true';

      // === Control de inactividad (2 minutos) ===
      function resetInactivityTimer() {
        clearTimeout(inactivityTimer);
        inactivityTimer = setTimeout(() => {
          console.log('‚è±Ô∏è Sesi√≥n expirada por inactividad');
          clearSession();
          showLogin('inactivity');
        }, 2 * 60 * 1000); // 2 minutos
        localStorage.setItem('lastActivity', Date.now());
      }

      // === Detectar actividad del usuario ===
      ['click', 'mousemove', 'keypress', 'scroll', 'touchstart'].forEach(evt => {
        document.addEventListener(evt, () => {
          if (isSessionActive()) {
            resetInactivityTimer();
          }
        }, { passive: true });
      });

      // === Iniciar sesi√≥n ===
      form.addEventListener('submit', (e) => {
        e.preventDefault();
        const user = usernameInput.value.trim();
        const pass = passwordInput.value.trim();

        if (user && pass) {
          console.log('üîë Iniciando sesi√≥n para:', user);
          startSession();
          hideLogin();
          resetInactivityTimer();
          console.log('‚úÖ Bienvenido al sistema');
        } else {
          alert('Por favor, completa todos los campos.');
        }
      });

      // === Cerrar sesi√≥n manualmente ===
      logoutBtn.addEventListener('click', (e) => {
        e.preventDefault();
        
        const confirmar = confirm('¬øEst√°s seguro de que deseas cerrar sesi√≥n?');
        
        if (confirmar) {
          console.log('üëã Cerrando sesi√≥n manualmente');
          clearSession();
          clearTimeout(inactivityTimer);
          showLogin('logout');
        }
      });

      // === Recuperaci√≥n de contrase√±a ===
      forgotPasswordLink.addEventListener('click', (e) => {
        e.preventDefault();
        showView(recoveryView);
        setTimeout(() => recoveryEmailInput.focus(), 100);
      });

      backToLoginLink.addEventListener('click', (e) => {
        e.preventDefault();
        showView(loginView);
        recoveryEmailInput.value = '';
        setTimeout(() => usernameInput.focus(), 100);
      });

      backToLoginConfirmed.addEventListener('click', (e) => {
        e.preventDefault();
        showView(loginView);
        setTimeout(() => usernameInput.focus(), 100);
      });

      // === Env√≠o de solicitud de recuperaci√≥n ===
      recoveryForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const email = recoveryEmailInput.value.trim();

        if (email) {
          // Validaci√≥n b√°sica de correo institucional
          if (!email.includes('@uacj.mx') && !email.includes('@')) {
            alert('Por favor, ingresa un correo electr√≥nico v√°lido.');
            return;
          }

          console.log('üìß Solicitud de recuperaci√≥n enviada para:', email);
          
          // Simular env√≠o (en producci√≥n, aqu√≠ har√≠as una llamada al backend)
          setTimeout(() => {
            showView(confirmationView);
            recoveryEmailInput.value = '';
          }, 500);
        } else {
          alert('Por favor, ingresa tu correo electr√≥nico.');
        }
      });

      // === Control inicial al cargar la p√°gina ===
      const lastActivity = parseInt(localStorage.getItem('lastActivity') || 0, 10);
      const now = Date.now();
      const INACTIVITY_TIMEOUT = 2 * 60 * 1000; // 2 minutos en milisegundos

      console.log('üìä Verificando estado de sesi√≥n...');
      
      if (!isSessionActive()) {
        console.log('‚ùå No hay sesi√≥n activa');
        clearSession();
        showLogin();
      } else if (now - lastActivity > INACTIVITY_TIMEOUT) {
        console.log('‚è±Ô∏è Sesi√≥n expirada (√∫ltima actividad hace m√°s de 2 minutos)');
        clearSession();
        showLogin('expired');
      } else {
        console.log('‚úÖ Sesi√≥n v√°lida - restaurando...');
        const tiempoRestante = Math.round((INACTIVITY_TIMEOUT - (now - lastActivity)) / 1000);
        console.log(`‚è±Ô∏è Tiempo restante: ${tiempoRestante} segundos`);
        hideLogin();
        resetInactivityTimer();
      }

      // === Prevenir que el modal se cierre haciendo clic fuera de √©l ===
      const overlay = modal.querySelector('.login-overlay');
      if (overlay) {
        overlay.addEventListener('click', (e) => {
          e.stopPropagation();
        });
      }
    });
    </script>
</body>
</html>